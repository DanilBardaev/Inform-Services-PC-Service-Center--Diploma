<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://kit.fontawesome.com/5833c2855b.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="./css/index.css" />
  <link rel="stylesheet" href="./css/register.css" />
  <title>Регистрация</title>
  <style>
    .error-message {
      margin-top: 10px;
      color: #ee1f09;
    }
    .error .form-control {
      border-color: #ee1f09;
    }
  </style>
</head>
<body>
  <header><%- include('./partials/header_main'); %></header>
  <section class="register-content">
    <div class="container-fluid">
      <div class="img-block pt-5">
        <h2 class="text-center">Регистрация в Информ-Сервис</h2>
        <p class="text-center">Зарегистрируйтесь для того чтобы видеть статусы ваших заявок и многое чего другого.</p>
        <img src="<%=messanger%>" alt="" />
      </div>
      <form id="form" method="post" action="/register" class="p-3">
        <div class="img-container">
          <img src="<%=link%>" style="width: 100px" />
          <h3 class="text-center">Регистрация в Информ <br>Сервисный центр</h3>
        </div>
        <div class="row g2">
          <div class="col-12 col-sm-12">
            <div class="form-floating mb-3">
              <input type="text" id="name" name="name" placeholder="Имя" class="form-control" />
              <label for="name">Имя:</label>
              <div class="error-message"></div>
            </div>
          </div>
        </div>
        <div class="row g-2 g-5">
          <div class="col-12 col-sm-12">
            <div class="form-floating mb-3">
              <input type="email" id="email" name="email" placeholder="Email" class="form-control" />
              <input type="hidden" name="recipientEmail" id="recipientEmail" value="">
              <label for="email">Email:</label>
              <div class="error-message"></div>
            </div>
          </div>
        </div>
        <div class="row g2 g-5">
          <div class="col-12 col-sm-12">
            <div class="form-floating mb-3">
              <input type="age" name="age" id="age" pattern="[0-9]*" class="form-control" placeholder="Возраст" title="Введите только цифры">
              <label for="age">Возраст:</label>
              <div class="error-message"></div>
            </div>
          </div>
        </div>
        <div class="row g2 g-5">
          <div class="col-12 col-sm-12">
            <div class="form-floating mb-3">
              <input type="password" id="password" name="password" class="form-control" placeholder="Пароль" pattern=".{6,}" />
              <label for="password">Пароль:</label>
              <div class="error-message"></div>
            </div>
          </div>
        </div>
        <div class="container button">
          <div class="col-12 col-sm-12">
            <button type="submit" class="btn">Зарегистрироваться</button>
          </div>
          <div class="row g-2 g-5">
            <div class="col-12 p-1">
              <a href="login" class="text-center text-decoration-none">Уже зарегистрированны? Войти</a>
            </div>
          </div>
        </div>
      </form>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          const form = document.getElementById("form");
          const name = document.getElementById("name");
          const email = document.getElementById("email");
          const age = document.getElementById("age");
          const password = document.getElementById("password");
          const recipientEmailField = document.getElementById("recipientEmail");

          email.addEventListener("input", function() {
            recipientEmailField.value = email.value;
          });

          function showError(input, message) {
            const formControl = input.closest(".form-floating");
            const errorElement = formControl.querySelector(".error-message");
            errorElement.innerText = message;
            formControl.classList.add("error");
          }

          function showSuccess(input) {
            const formControl = input.closest(".form-floating");
            const errorElement = formControl.querySelector(".error-message");
            errorElement.innerText = "";
            formControl.classList.remove("error");
          }

          function checkEmail(input) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (re.test(input.value.trim())) {
              showSuccess(input);
            } else {
              showError(input, "Адрес электронной почты имеет неверный формат");
            }
          }

          function checkRequired(inputElements) {
            let isRequired = false;
            inputElements.forEach(function(input) {
              if (input.value.trim() === "") {
                showError(input, `Поле не может быть пустым`);
                isRequired = true;
              } else {
                showSuccess(input);
              }
            });
            return isRequired;
          }

          function checkLength(input, min, max) {
            if (input.value.length < min) {
              showError(input, `Поле должно быть длиной не менее ${min} символов`);
            } else if (input.value.length > max) {
              showError(input, `Поле не должно быть длиной более ${max} символов`);
            } else {
              showSuccess(input);
            }
          }

          form.addEventListener("submit", function(e) {
            e.preventDefault();
            const isRequiredEmpty = checkRequired([name, email, age, password]);
            checkLength(name, 3, 15);
            checkLength(password, 6, 25);
            checkEmail(email);

            if (!isRequiredEmpty && 
                name.value.length >= 3 && name.value.length <= 15 &&
                password.value.length >= 6 && password.value.length <= 25 &&
                email.value.trim().match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)
            ) {
              form.submit();
            }
          });
        });
      </script>
    </div>
  </section>
  <footer><%- include('./partials/footer')%></footer>
</body>
</html>
